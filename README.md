# Бот магазина «Молоток»

Telegram-бот для приёма заказов и выдачи каталога/контактов. Заказы логируются в файл и SQLite и пересылаются администратору.

## Шаг 1: Переменные окружения (безопасный запуск)

Токен и ID админа **не хранятся в коде** — только в файле `.env`.

1. Скопируйте шаблон в `.env`:
   ```bash
   cp .env.example .env
   ```
   (В Windows: скопируйте файл `.env.example` и переименуйте копию в `.env`.)

2. Откройте `.env` и заполните:
   - **TELEGRAM_BOT_TOKEN** — токен от [@BotFather](https://t.me/BotFather).
   - **ADMIN_CHAT_ID** — ваш Telegram ID (узнать: напишите боту [@userinfobot](https://t.me/userinfobot), скопируйте число **Id**).

Файл `.env` в репозиторий не попадает (см. `.gitignore`).

## Шаг 2: Установка зависимостей

```bash
pip install -r requirements.txt
```

## Шаг 3: Запуск

Из корня проекта:

```bash
python main.py
```

Остановка: **Ctrl+C**.

Если не создан `.env` или не указан токен/ADMIN_CHAT_ID, программа выведет понятную ошибку и не запустит бота.

## Структура проекта

| Файл/папка | Назначение |
|------------|------------|
| `main.py` | Точка входа: загрузка конфига, регистрация хендлеров, запуск бота |
| `config.py` | Чтение `.env`, проверка TELEGRAM_BOT_TOKEN и ADMIN_CHAT_ID |
| `bot.py` | Создание экземпляра `TeleBot` (токен из config) |
| `handlers/` | Обработчики: `/start`, кнопки (каталог, контакты, заказ), приём заказов |
| `storage/orders.py` | Сохранение заказа в `data/orders.log` и `data/orders.db` |
| `data/` | Создаётся автоматически: лог заказов и SQLite-БД |

## Логирование заказов

- **Файл** `data/orders.log` — одна строка на заказ (дата, user_id, chat_id, username, текст). Удобно открыть в блокноте или Excel.
- **БД** `data/orders.db` — таблица `orders` (id, created_at, user_id, chat_id, username, order_text). Удобно для выборок и отчётов.

Каждый новый заказ дополнительно **пересылается** в чат администратора (ADMIN_CHAT_ID) в виде сообщения с текстом заказа и данными пользователя.

## Старый запуск из одного файла

Раньше бот запускался из `molotok_bot.py`. Теперь точка входа — `main.py`; старый файл можно оставить как резервную копию или удалить после проверки нового запуска.

## История изменений

Подробное описание рефакторинга (безопасный запуск, структура, логирование, пересылка админу) — в файле [CHANGELOG.md](CHANGELOG.md).

## Публикация на GitHub

Репозиторий уже инициализирован (есть первый коммит). Чтобы выложить проект на GitHub:

1. Создайте новый репозиторий на [github.com](https://github.com/new): нажмите **New**, введите имя (например `molotok-bot`), не добавляйте README/.gitignore — они уже есть в проекте.
2. В папке проекта выполните (подставьте свой логин и имя репозитория):

   ```bash
   git remote add origin https://github.com/ВАШ_ЛОГИН/molotok-bot.git
   git branch -M main
   git push -u origin main
   ```

   Либо по SSH: `git@github.com:ВАШ_ЛОГИН/molotok-bot.git`

После пуша на GitHub будут видны **README.md** (инструкция по запуску) и **CHANGELOG.md** (полное описание всех сделанных изменений).
